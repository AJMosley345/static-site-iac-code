---
- name: Set plugin to have classic containment, then install it
  ansible.builtin.shell: |
    snap set certbot trust-plugin-with-root=ok
    snap install certbot-dns-route54

- name: Create certbot settings folder
  ansible.builtin.file:
    path: /etc/letsencrypt/.aws
    state: directory
    owner: root
    group: root
    mode: '0700'

- name: Create Certbot config files
  ansible.builtin.template:
    src: ""
    dest: ""
    owner: root
    group: root
    mode: '0600'
  with_items:
    - { src: 'files/templates/aws_credentials.j2', dest: '/etc/letsencrypt/.aws/config'}
    - { src: 'files/templates/letsencrypt_cli.ini.j2', dest: '/etc/letsencrypt/cli.ini'}
